<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF8">
    <title>PTAnywhere session viewer</title>

    <!-- JQuery -->
    <script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="bower_components/jquery-ui/jquery-ui.min.js"></script>
    <!-- For the slider -->
    <link rel="stylesheet" href="bower_components/jquery-ui/themes/base/jquery-ui.min.css">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap-theme.css">
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

    <!-- Bootstrap Datetimepicker & Moment.js dependency-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/css/bootstrap-datetimepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/js/bootstrap-datetimepicker.min.js"></script>

    <script type="text/javascript" src="js/commons.js"></script>

    <style type="text/css">
        .well {
            font: 10pt monospace, Helvetica, Arial;
            white-space: pre;
            background: white;
        }
    </style>

    <!-- Listing -->
    <script type="text/javascript" src="data/vocabulary.js"></script>
    <script type="text/javascript">
        // Starts with (not yet supported by all browsers)
        String.prototype.startsWith = function(suffix) {
            return this.indexOf(suffix, 0) === 0;
        };

        function getId(url) {
            var els = url.split("/");
            var ret = els[els.length-1];
            if (ret.length!=0) return ret;
            return els[els.length-2];
        }

        $(function() {
            var sessionId = queryParameter.get('session');
            if (sessionId!=null) {
                var cmdSessionNumber = 0;

                var listener = statements.newListener();
                listener.onCreateDevice(function(dext) {
                        $('#actions').append('<li>Creating ' + dext[extension.device.name] + '</li>');
                    }).
                    onCreateLink(function(dext) {
                        var ends = dext[extension.endpoints];
                        $('#actions').append('<li>Connecting ' + ends[0].device + ' and ' + ends[1].device + '</li>');
                    }).
                    onDeleteDevice(function(dext) {
                        $('#actions').append('<li>Deleting ' + dext[extension.device.name] + '</li>');
                    }).
                    onDeleteLink(function(dext) {
                        var ends = dext[extension.endpoints];
                        $('#actions').append('<li>Disconnecting ' + ends[0].device + ' and ' + ends[1].device + '</li>');
                    }).
                    onUpdateDevice(function(dext) {
                        $('#actions').append('<li>Updating ' + dext[extension.device.name] + '</li>');
                    }).
                    onUpdatePort(function(dext) {
                        $('#actions').append('<li>Updating ' + dext[extension.device.name] + '\'s port: ' + dext[extension.port.name] + '</li>');
                    }).
                    onOpenCommandLine(function(cmdName) {
                        cmdSessionNumber++;
                        var cmdSessionId = "collapsedSession" + cmdSessionNumber;
                        var html = '<li><a href="#' + cmdSessionId + '" data-toggle="collapse" ' +
                                   'aria-expanded="false" aria-controls="' + cmdSessionId + '">' +
                                   'Using ' + cmdName + '</a><div id="' + cmdSessionId + '" class="collapse">' +
                                   '<div class="well"></div></div></li>';
                        $('#actions').append(html);
                    }).
                    onCloseCommandLine(function() {
                        //$('#actions').append('<li>Closed</li>');
                    }).
                    onUseCommandLine(function(dext) {
                        //$('#actions').append('<li>Use</li>');
                    }).
                    onReadCommandLine(function(response) {
                        var cmdSessionId = "collapsedSession" + cmdSessionNumber;
                        $('#' + cmdSessionId + ' .well').append(response);
                    });

                $.getJSON('../data/sessions/' + sessionId, function(registration) {
                    for(var i=0; i<registration.statements.length; i++) {
                        listener.onStatement(registration.statements[i]);
                    }
                }).fail(errorDialog.open);
            }
        });
    </script>
</head>
<body>
<div class="container">
    <ol class="breadcrumb">
        <li><a href="javascript:history.back()">Home</a></li>
    </ol>

    <h1>Session</h1>

    <div class="row" style="margin: 20px 0;">
        <div class="col-md-12">
            <ol id="actions"></ol>
        </div>
    </div>

    <div id="errorDialog" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog">
              <div class="modal-content">
                    <div class="modal-header">
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                          <h4 class="modal-title">Error loading data</h4>
                    </div>
                    <div class="modal-body">
                          <p></p>
                    </div>
                    <div class="modal-footer">
                          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
              </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
</div>
</div>
</body>
</html>