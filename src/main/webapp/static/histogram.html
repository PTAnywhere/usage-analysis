<!DOCTYPE html>
<html>
<head>
      <meta http-equiv="content-type" content="text/html; charset=UTF8">
      <title>PTAnywhere widget usage histogram</title>

      <!-- JQuery -->
      <script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>

      <!-- Bootstrap -->
      <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
      <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap-theme.css">
      <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

      <!-- Bootstrap Datetimepicker & Moment.js dependency-->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/css/bootstrap-datetimepicker.min.css">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/js/bootstrap-datetimepicker.min.js"></script>

      <script type="text/javascript" src="js/commons.js"></script>

      <!-- Chart.js -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script>


      <script type="text/javascript">

            function createLabels(beginDate, steps) {
                var ret = [];
                for (var i=0; i<steps; i++) {
                    ret.push(beginDate.format('MM/DD/YYYY HH'));
                    beginDate.add(1, 'hours');
                }
                return ret;
            }

            function createChart(chartId, startTime, data) {
                var ctx = document.getElementById(chartId).getContext("2d");
                var data = {
                    labels: createLabels(startTime, data.length),
                    datasets: [
                        {
                            label: "Sessions started",
                            fillColor: "rgba(151,187,205,0.7)",
                            strokeColor: "rgba(151,187,205,0.8)",
                            highlightFill: "rgba(151,187,205,0.9)",
                            highlightStroke: "rgba(151,187,205,1)",
                            data: data
                        }
                    ]
                };
                var options = {
                    responsive: true,
                    barShowStroke: false,
                    scaleShowHorizontalLines: true,
                    barValueSpacing: 0,
                    barValueSpacing: 0
                };
                return new Chart(ctx).Bar(data, options);
            }


            $(function() {
                timeFilter.configure('startTime', 'endTime');
                timeFilter.setStartDate( moment('2016-01-27').startOf('day') );
                timeFilter.setEndDate( moment('2016-01-28').endOf('day') );

                $('#btnUpdate').click(function() {
                    $.getJSON('../data/sessions/counter?' + timeFilter.getURLParameters())
                        .done(function(histogram) {
                            myBarChart.destroy();
                            var startTime = moment(histogram.start);
                            myBarChart = createChart('myChart', startTime, histogram.values);
                            console.log(histogram);
                        });
                });
                var fakeData = [65, 59, 80, 81, 56, 55, 40, 41];
                var myBarChart = createChart('myChart', moment(), fakeData);
            });
      </script>
</head>
<body>
<div class="container">
    <h1>Usage histogram</h1>

    <div class="row">
        <div class="col-md-1">Start: </div>
        <div class="col-md-3">
            <div class='input-group date' id='startTime'>
                <input type='text' class="form-control" />
                <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                </span>
            </div>
        </div>
        <div class="col-md-1 col-md-offset-1">Finish: </div>
        <div class="col-md-3">
            <div class='input-group date' id='endTime'>
                <input type='text' class="form-control" />
                <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                </span>
            </div>
        </div>
        <div class="col-md-1 col-md-offset-1">
            <button type="button" class="btn btn-primary" id="btnUpdate">Update</button>
        </div>
    </div>

    <div class="row" style="margin-top: 5%;">
      <canvas id="myChart" style="width: 100%; height: 400px;"></canvas>
    </div>
</div>
</body>
</html>
