/**
 * dashboardApp - A dashboard to analyse PT Anywhere usage.
 * @version v2.0.1
 * @link https://github.com/PTAnywhere/usage-analysis
 */
angular.module("dashboardApp",[]).config(["$injector","$provide",function(t,e){var a={baseUrl:""};for(var n in a)try{t.get(n)}catch(r){console.log('Setting default value for non existing "baseUrl" constant: "'+a[n]+'"'),e.constant(n,a[n])}}]),angular.module("dashboardApp").directive("barChart",[function(){function t(t,e){return new Chart(t,{type:"bar",data:e,options:{barPercentage:1}})}return{restrict:"C",template:'<div ng-if="chartData === null">Loading...</div><canvas style="width: 100%; height: 400px;"></canvas>',scope:{chartData:"="},link:function(e,a,n){e.chart=null,e.$watch("chartData",function(n,r){if(null!==n){var s=a.find("canvas")[0].getContext("2d");null===e.chart?e.chart=t(s,e.chartData):(e.chart.destroy(),e.chart=t(s,e.chartData))}})}}}]).directive("scatterplot",[function(){function t(t,e,a){var n=t.find(".scatter")[0],r=new vis.DataSet(e);return new vis.Graph2d(n,r,a)}return{restrict:"C",template:'<div ng-if="chartData === null">Loading...</div><div class="scatter"></div>',scope:{chartData:"=",chartOptions:"="},link:function(e,a,n){e.chart=null,e.$watch("chartData",function(n,r){null!==n&&(null===e.chart?e.chart=t(a,n,e.chartOptions):(e.chart.destroy(),e.chart=t(container,n,e.chartOptions)))})}}}]).directive("slider",[function(){function t(t,e,a){n=$(t.find("div")[0]),n.slider({range:"min",slide:e,stop:a})}function e(){return n.slider("value")}function a(t,a){var r=e();n.slider("option","min",0===t?0:1),n.slider("option","max",t),(0===r||r>t)&&(n.slider("value",t>=3?3:t),a.onChange({value:e()}))}var n;return{restrict:"C",template:"<div></div>",scope:{onSlide:"&",onChange:"&",sliderMax:"="},link:function(e,n,r){t(n,function(t,a){e.onSlide({value:a.value})},function(t,a){e.onChange({value:a.value})}),a(e.sliderMax,e),e.$watch("sliderMax",function(t,n){a(t,e)})}}}]).directive("stateDiagram",["StateDiagramHelper",function(t){return{restrict:"C",template:"<div></div>",scope:{data:"=",levelsToShow:"=",finalDisplayed:"@"},link:function(e,a,n){t.init(a.find("div")[0],"true"===e.finalDisplayed),e.$watchGroup(["data","levelsToShow"],function(e,a){t.update(e[0],e[1])})}}}]),angular.module("dashboardApp").filter("simpleUuid",[function(){function t(t){for(var e=t.toString(),a="",n=0;n<e.length;n+=2)a+=String.fromCharCode(parseInt(e.substr(n,2),16));return a}return function(e){var a=e.replace(/-/g,""),n=btoa(t(a));return n.replace(/\+/g,".").replace(/\//g,"_").replace(/=/g,"-")}}]).filter("momentDate",[function(){return function(t,e){return t.format(e)}}]),angular.module("dashboardApp").factory("TimeCache",[function(){return{getDefaultStart:function(){var t=localStorage.getItem("startISO");return null===t?moment().startOf("day"):moment(t)},getDefaultEnd:function(){var t=localStorage.getItem("endISO");return null===t?moment().endOf("day"):moment(t)},store:function(t,e){localStorage.setItem("startISO",t),localStorage.setItem("endISO",e)}}}]).factory("SessionsService",["$http","baseUrl",function(t,e){return{list:function(a){return t.get(e+"/a/data/sessions",{params:a})},getSessionCount:function(a){return t.get(e+"/a/data/sessions/counter",{params:a})},getActivityVolumePerSession:function(a){return t.get(e+"/a/data/sessions/perStatements",{params:a})},getSessionsForScatterplot:function(a){return t.get(e+"/a/data/sessions/scatterplot",{params:a})},getSessionsUsageStates:function(a){return t.get(e+"/a/data/usage",{params:a})},getSessionUsageStates:function(a){var n=[t.get(e+"/a/data/usage/"+a+"/passed"),t.get(e+"/a/data/usage/"+a)];return Promise.all(n).then(function(t){var e=t[1].data,a=t[0].data.passed?"pass":"fail",n=e.levels[e.levels.length-1][0].to,r=[{from:n,to:a,value:1,title:"1 session"}];return e.levels.push(r),e})}}}]).factory("StateDiagramHelper",[function(){function t(){for(var t="0123456789ABCDEF".split(""),e="#",a=0;6>a;a++)e+=t[Math.floor(16*Math.random())];return e}function e(e,a){var n=null;r.clear();for(var s=0;a>s;s++){n=t();for(var o=0;o<e.length;o++)r.add({id:String(s)+":"+String(o),label:e[o],color:n,size:10,x:100*o,y:100*(s+1)})}return r.add({id:"init",label:"init",color:t(),x:100*(e.length-1)/2,y:0,size:10}),n=t(),r.add([{id:"pass",label:"pass",color:n,size:10,x:100*(e.length-1)/3,y:100*(a+1)},{id:"fail",label:"fail",color:n,size:10,x:200*(e.length-1)/3,y:100*(a+1)}]),r}function a(t,e){s.clear();for(var a=0;a<t.length&&e>a;a++)s.add(t[a]);return s}var n,r=new vis.DataSet,s=new vis.DataSet,o=!1;return{init:function(t,e){"undefined"!=typeof o&&(o=e);var a={nodes:r,edges:s},i={nodes:{shape:"dot",font:{face:"Tahoma"}},edges:{width:.1,smooth:{type:"continuous"},arrows:{to:{scaleFactor:.2}}},interaction:{dragNodes:!1},physics:{enabled:!1}};n=new vis.Network(t,a,i)},_getRandomColor:t,_drawStates:e,_drawEdges:a,update:function(t,r){e(t.states,r);var s=o&&r+1==t.levels.length?1:0;a(t.levels,r+s),n.fit()}}}]),angular.module("dashboardApp.search",["ae-datetimepicker","dashboardApp"]).controller("SearchController",["$window","TimeCache","SessionsService",function(t,e,a){function n(){var t=s.startTime.toISOString(),a=s.endTime.toISOString(),n={start:t,end:a};return e.store(t,a),n}function r(){var t=n();return t.minStatements=s.actionsNum,t.containsCommand=s.containsCommand,t}var s=this,o="YYYY/MM/DD HH:mm";s.startTime=e.getDefaultStart(),s.endTime=e.getDefaultEnd(),s.startTimeOptions={format:o},s.endTimeOptions={format:o,minDate:moment(s.startTime).add(1,"hours")},s.actionsNum=1,s.containsCommand="",s.sessions=[],s.getUrlParams=function(){var t="",e=r();for(var a in e)t+=a+"="+e[a]+"&";return""!==t&&(t="?"+t.substring(0,t.length-1)),t},s.startTimeUpdate=function(){s.endTimeOptions.minDate=moment(s.startTime).add(1,"hours"),s.endTime<s.endTimeOptions.minDate&&(s.endTime=s.endTimeOptions.minDate)},s.list=function(){a.list(r()).then(function(t){s.sessions=t.data},function(t){console.error(t)})},s.showStatesChart=function(){t.location.href="summary.html#/usage"+s.getUrlParams()},s.showSessionsStartedHistogram=function(){t.location.href="summary.html#/started"+s.getUrlParams()},s.showInteractionCountingHistogram=function(){t.location.href="summary.html#/activity"+s.getUrlParams()},s.showInteractionCountingScatterplot=function(){t.location.href="summary.html#/scatterplot"+s.getUrlParams()}}]),angular.module("dashboardApp.summary",["ngRoute","dashboardApp"]).constant("ROUTES",{steps:{name:"Usage steps",path:"/usage"},started:{name:"Sessions started",path:"/started"},activity_count:{name:"Activity count",path:"/activity"},activity_scatterplot:{name:"Activity volume over time",path:"/scatterplot"}}).config(["$routeProvider","baseUrl","ROUTES",function(t,e,a){t.when(a.steps.path,{templateUrl:e+"/static/html/usage-steps.html"}).when(a.started.path,{templateUrl:e+"/static/html/sessions-started.html"}).when(a.activity_count.path,{templateUrl:e+"/static/html/activities-count.html"}).when(a.activity_scatterplot.path,{templateUrl:e+"/static/html/activities-scatterplot.html"}).otherwise({redirectTo:a.started.path}),Chart.defaults.global.elements.line.backgroundColor="rgba(151,187,205,0.8)",Chart.defaults.global.elements.rectangle.backgroundColor="rgba(151,187,205,0.7)",Chart.defaults.global.legend.display=!1}]),angular.module("dashboardApp.summary").controller("SummaryController",["$routeParams","$scope","ROUTES",function(t,e,a){function n(t){var e="";for(var a in t)e+=a+"="+t[a]+"&";return""!==e&&(e="?"+e.substring(0,e.length-1)),e}function r(t,e){var a=[];for(var n in t)a.push({name:t[n].name,url:"#"+t[n].path+e});return a}var s=this;s.title="Hello",e.$on("$routeChangeSuccess",function(){var e=n(t);s.charts=r(a,e)})}]).controller("SessionsStartedController",["$routeParams","SessionsService",function(t,e){function a(t,e){for(var a=[],n=0;e>n;n++)a.push(t.format("MM/DD/YYYY HH")),t.add(1,"hours");return a}function n(t,e){return{labels:a(t,e.length),datasets:[{label:"Sessions started",data:e}]}}var r=this;r.data=null,e.getSessionCount(t).then(function(t){r.data=n(moment(t.data.start),t.data.values)},function(t){console.error(t)})}]).controller("ActivityCountController",["$routeParams","SessionsService",function(t,e){function a(t){for(var e=[],a=1;t>=a;a++)e.push(a);return e}function n(t){return{labels:a(t.length),datasets:[{label:"Sessions with this amount of activities",data:t}]}}var r=this;r.data=null,e.getActivityVolumePerSession(t).then(function(t){r.data=n(t.data)},function(t){console.error(t)})}]).controller("ActivityScatterplot",["$routeParams","SessionsService",function(t,e){var a=this;a.sessions=null,a.options={sort:!1,sampling:!1,style:"points",dataAxis:{showMinorLabels:!1,left:{title:{text:"Number of interactions"}},right:{title:{text:"Session starting time"}}},drawPoints:{enabled:!0,size:6,style:"circle"},defaultGroup:"Scatterplot"},e.getSessionsForScatterplot(t).then(function(t){for(var e=t.data,n=0;n<e.length;n++)e[n].x=moment(e[n].x);a.sessions=e},function(t){console.error(t)})}]).controller("UsageStatesController",["$scope","$routeParams","SessionsService",function(t,e,a){var n=this;n.levels=0,n.slidedLevels=0,n.data={states:[],levels:[]},n.maxLevels=0,n.onSlide=function(e){n.slidedLevels=e,t.$$phase||t.$apply()},n.onChange=function(e){n.levels=e,n.slidedLevels=e,t.$$phase||t.$apply()},a.getSessionsUsageStates(e).then(function(e){n.data=e.data,n.maxLevels=n.data.levels.length,t.$$phase||t.$apply()},function(t){console.error(t)})}]),angular.module("dashboardApp.session",["ngRoute","dashboardApp"]).controller("UsageStatesController",["$scope","$routeParams","SessionsService",function(t,e,a){var n=this;n.levels=0,n.slidedLevels=0,n.data={states:[],levels:[]},n.maxLevels=0,n.onSlide=function(e){n.slidedLevels=e,t.$$phase||t.$apply()},n.onChange=function(e){n.levels=e,n.slidedLevels=e,t.$$phase||t.$apply()};var r="7ba8361b-e9a2-4e26-8a64-f88c35513e24";a.getSessionUsageStates(r).then(function(e){n.data=e,n.maxLevels=n.data.levels.length-1,t.$$phase||t.$apply()},function(t){console.error(t)})}]);